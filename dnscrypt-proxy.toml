##############################################
# DNSCRYPT-PROXY —  АНТИЦЕНЗУРА, АНОНИМНОСТЬ
##############################################

listen_addresses = ['127.0.0.10:53']
max_clients = 250

ipv4_servers = true
ipv6_servers = false

dnscrypt_servers = true
doh_servers = true
odoh_servers = true

require_dnssec = true
require_nolog = true
require_nofilter = true

force_tcp = false
http3 = true
timeout = 15000
keepalive = 30

log_level = 2

fallback_resolver = '9.9.9.9:53'
ignore_system_dns = true


##############################################
# СЕРВЕРА — оптимальные для РФ
##############################################

server_names = [
  # DNSCrypt (быстро + стабильно)
  'dnscry.pt-frankfurt-ipv4',
  'dnscry.pt-warsaw02-ipv4',
  'dnscry.pt-amsterdam-ipv4',
  'scaleway-fr',
  'scaleway-ams',

  # ODoH (медленно, но анонимно)
  'odoh-crypto-sx',
  'odoh-marco.cx'
]

##############################################
# АНОНИМИЗАЦИЯ
# 1 relay → обход цензуры без timeout
##############################################

[anonymized_dns]

routes = [
  # ODoH — единственный relay
  { server_name='odoh-crypto-sx', via=['odohrelay-crypto-sx'] },
  { server_name='odoh-marco.cx',  via=['odohrelay-crypto-sx'] },

  # DNSCrypt — быстрые релеев
  { server_name='dnscry.pt-frankfurt-ipv4', via=['anon-cs-de'] },
  { server_name='dnscry.pt-warsaw02-ipv4',   via=['anon-cs-nl'] },
  { server_name='dnscry.pt-amsterdam-ipv4', via=['anon-cs-nl'] },
  { server_name='scaleway-fr',              via=['anon-scaleway'] },
  { server_name='scaleway-ams',             via=['anon-scaleway'] },

  # fallback
  { server_name='*', via=['anon-cs-nl'] }
]

skip_incompatible = true

##############################################
# ИСТОЧНИКИ (оригинальные)
##############################################

[sources]

[sources.public-resolvers]
urls = [
  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/public-resolvers.md',
  'https://download.dnscrypt.info/resolvers-list/v3/public-resolvers.md',
]
cache_file = 'public-resolvers.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 72

[sources.relays]
urls = [
  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/relays.md',
  'https://download.dnscrypt.info/resolvers-list/v3/relays.md',
]
cache_file = 'relays.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 72

[sources.odoh-servers]
urls = [
  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/odoh-servers.md',
  'https://download.dnscrypt.info/resolvers-list/v3/odoh-servers.md',
]
cache_file = 'odoh-servers.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 72

[sources.odoh-relays]
urls = [
  'https://raw.githubusercontent.com/DNSCrypt/dnscrypt-resolvers/master/v3/odoh-relays.md',
  'https://download.dnscrypt.info/resolvers-list/v3/odoh-relays.md',
]
cache_file = 'odoh-relays.md'
minisign_key = 'RWQf6LRCGA9i53mlYecO4IzT51TGPpvWucNSCh1CBM0QTaLn73Y7GFO3'
refresh_delay = 72
